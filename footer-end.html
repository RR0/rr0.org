<script>
  let pathname = window.location.pathname
  if (pathname.indexOf(".") < 0 && !pathname.endsWith("/")) {
    pathname += "/"
    history.replaceState(null, "", pathname)
  }
</script>
<!--script>
  const allContext = document.querySelectorAll(".rr0-context")
  for (let i = 0; i < allContext.length; i++) {
    const contextEl = allContext[i]
    const subContext = contextEl.classList
    let context = pageContext
    for (let j = 1; j < subContext.length; j++) {
      const sub = subContext[j]
      const existing = context[sub]
      if (existing) {
        context = existing
      } else {
        const newContext = {_enabled: true}
        context[sub] = newContext
        context = newContext
      }
    }
  }
  const inputs = document.getElementById("rr0-context-select")

  function setContext(clazz, checked) {
    const all = document.querySelectorAll(`.rr0-context.${clazz.substring("enable-".length)}`)
    all.forEach(el => {
      el.style.display = checked ? "list-item" : "none"
    })
  }

  function upTo(from, tagName) {
    let curr = from
    if (curr) {
      while (curr.parentElement && curr.parentElement.tagName !== tagName.toUpperCase()) {
        curr = curr.parentElement
      }
      curr = curr.parentElement
    }
    return curr
  }

  function downTo(from, selector) {
    return from.querySelector(selector)
  }

  function enableParents(target) {
    const from = upTo(upTo(target, "details"), "details")
    if (from) {
      const parentInput = downTo(from.firstElementChild, "input[type='checkbox']")
      if (parentInput && !parentInput.checked) {
        parentInput.dispatchEvent(new MouseEvent("click"))
      }
    }
  }

  function disableChildren(target) {
    const from = target.parentElement.parentElement.nextElementSibling
    if (from) {
      const childInput = from.querySelector("input[type='checkbox']")
      if (childInput && childInput.checked) {
        childInput.dispatchEvent(new MouseEvent("click"))
      }
    }
  }

  function addInput(context) {
    const container = document.createElement("div")
    for (const [k, v] of Object.entries(context)) {
      if (k !== "_enabled") {
        const input = document.createElement("input")
        input.type = "checkbox"
        input.checked = v._enabled
        input.name = "enable-" + k
        console.log((input.checked ? "enabling" : "disabling") + " " + k)
        input.onchange = e => {
          const target = e.target
          const clazz = target.name
          const checked = target.checked
          console.log((checked ? "enabling" : "disabling") + " " + clazz)
          setContext(clazz, checked)
          if (checked) {
            enableParents(target)
          } else {
            disableChildren(target)
          }
        }
        const label = document.createElement("label")
        label.textContent = k
        label.appendChild(input)

        let subContainer = addInput(v)
        if (subContainer.hasChildNodes()) {
          const summary = document.createElement("summary")
          summary.appendChild(label)
          const details = document.createElement("details")
          details.appendChild(summary)
          details.appendChild(subContainer.firstChild)
          container.appendChild(details)
        } else {
          container.appendChild(label)
        }
      }
    }
    return container
  }

  const container = addInput(pageContext)
  inputs.appendChild(container)
</script-->
<script>
  if (window !== top) document.querySelectorAll(".full-page").forEach(elem => elem.style.display = "none")
</script>
</body></html>
