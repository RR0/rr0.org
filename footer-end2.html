<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0-rc.2/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0-rc.2/angular-sanitize.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-i18n/1.2.15/angular-locale_fr-fr.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.15/angular-ui-router.min.js"></script>
<script src="https://www.google.com/jsapi" type="text/javascript"></script>
<script src="/bower_components/VirtualSky/virtualsky.js"></script>
<script src="/bower_components/VirtualSky/virtualsky-planets.min.js"></script>
<script src="/rr0.js"></script>
<script>
  let pathname = window.location.pathname
  if (pathname.indexOf(".") < 0 && !pathname.endsWith("/")) {
    pathname += "/"
    history.replaceState(null, "", pathname)
  }
</script>
<script>
  const allContext = document.querySelectorAll(".rr0-context")
  for (let i = 0; i < allContext.length; i++) {
    const contextEl = allContext[i]
    const subContext = contextEl.classList
    let context = pageContext
    for (let j = 1; j < subContext.length; j++) {
      const sub = subContext[j]
      const existing = context[sub]
      if (existing) {
        context = existing
      } else {
        const newContext = {_enabled: true}
        context[sub] = newContext
        context = newContext
      }
    }
  }
  const inputs = document.getElementById("rr0-context-select")

  function setContext(clazz, checked) {
    const all = document.querySelectorAll(`.rr0-context.${clazz}`)
    all.forEach(el => {
      el.style.display = checked ? "list-item" : "none"
    })
  }

  function enableParents(target) {
    if (target.classList.contains("rr0-context"))
      }

  function addInput(context) {
    const container = document.createElement("div")
    for (const [k, v] of Object.entries(context)) {
      if (k !== "_enabled") {
        const input = document.createElement("input")
        input.type = "checkbox"
        input.checked = v._enabled
        input.name = k
        input.onchange = e => {
          const target = e.target
          const clazz = target.name
          const checked = target.checked
          setContext(clazz, checked)
          if (checked) {
            enableParents(target)
          } else {
            disableChildren(target)
          }
          let parent1 = target.parentElement.parentElement
          if (parent1.tagName === "SUMMARY") {
            parent1 = parent1.parentElement
          }
          const subChecks =
            parent1.querySelectorAll(`details input[type="checkbox"]`)
          subChecks.forEach(sub => sub.checked = checked)
        }
        const label = document.createElement("label")
        label.textContent = k
        label.appendChild(input)

        let subContainer = addInput(v)
        if (subContainer.hasChildNodes()) {
          const summary = document.createElement("summary")
          summary.appendChild(label)
          const details = document.createElement("details")
          details.appendChild(summary)
          details.appendChild(subContainer.firstChild)
          container.appendChild(details)
        } else {
          container.appendChild(label)
        }
      }
    }
    return container
  }

  const container = addInput(pageContext)
  inputs.appendChild(container)

</script>
</body></html>
